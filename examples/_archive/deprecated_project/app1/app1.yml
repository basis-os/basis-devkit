name: app1
app_params:
  limit: 100
nodes:
  - name: source1
    component: basis_components.stripe.stripe_event_streams
    component_params:
      resources:
        - transactions
        - refunds
    node_resources:
      storage: storage2
      cpu: 4
      memory: 16
    # Not doing these:
    # append_events_to_tables: true
    # insert_events_into_table: true
    # emit_event_stream: true
    outputs:
      transactions:
        table: source1_transactions
        stream: source1_transactions_stream
        # storage not supported at this level

  # Alternative: aggregate is explicit node
  - name: source1_table
    component: create_table_from_stream
    input: source1_transactions_stream
    # inputs:
    #   inputname: source1_transactions_stream
    # outputs:
    #   outputname:
    #     table: source1_table_alt
  - name: comp1
    component: component1.py

    input: source1_transactions
    # input: Stream(app1_source1__transactions)

    # input: app1.source1@transactions#table
    # input: source1
    # input: source1#table
    # input: source1@outputname
    # input: source1@outputname#table
    # input: app1.source1#table

  - name: comp2
    component: component2.py
    input: source1.refunds
    node_params:
      limit: ${{ app_params.limit }}
